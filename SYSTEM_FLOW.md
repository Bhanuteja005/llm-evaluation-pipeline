# LLM Evaluation Pipeline - System Flow Visualization

## High-Level Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          INPUT FILES                                     â”‚
â”‚                                                                          â”‚
â”‚  conversation.json              context_vectors.json                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ chat_id          â”‚          â”‚ status              â”‚                 â”‚
â”‚  â”‚ user_id          â”‚          â”‚ data:               â”‚                 â”‚
â”‚  â”‚ conversation_turnsâ”‚          â”‚   vector_data[]     â”‚                 â”‚
â”‚  â”‚   - turn         â”‚          â”‚     - id            â”‚                 â”‚
â”‚  â”‚   - role         â”‚          â”‚     - text          â”‚                 â”‚
â”‚  â”‚   - message      â”‚          â”‚     - source_url    â”‚                 â”‚
â”‚  â”‚   - timestamp    â”‚          â”‚     - tokens        â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚                            â”‚
             â–¼                            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ingest.py     â”‚          â”‚   models.py      â”‚
    â”‚  - Validate    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   - Pydantic     â”‚
    â”‚  - Parse JSON  â”‚          â”‚   - Type Check   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚        CONVERSATION OBJECT                  â”‚
    â”‚  â€¢ Latest user message                      â”‚
    â”‚  â€¢ Conversation history                     â”‚
    â”‚  â€¢ Metadata (chat_id, user_id)             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚      prompt_builder.py                      â”‚
    â”‚  â€¢ Format conversation context              â”‚
    â”‚  â€¢ Select top-K relevant vectors            â”‚
    â”‚  â€¢ Build prompt template                    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚             PROMPT                          â”‚
    â”‚  "You are a helpful assistant..."           â”‚
    â”‚  CONTEXT: [vector texts]                    â”‚
    â”‚  QUESTION: [user message]                   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚          llm_client.py                      â”‚
    â”‚                                             â”‚
    â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
    â”‚  â”‚ MockClient   â”‚    â”‚  OpenAIClient   â”‚  â”‚
    â”‚  â”‚ (offline)    â”‚    â”‚  (gpt-3.5/4)    â”‚  â”‚
    â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
    â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
    â”‚                    â–¼                        â”‚
    â”‚          Track: latency, tokens, cost      â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         LLM RESPONSE                        â”‚
    â”‚  â€¢ text: "Based on the information..."      â”‚
    â”‚  â€¢ latency_ms: 245                          â”‚
    â”‚  â€¢ token_count: 150                         â”‚
    â”‚  â€¢ estimated_cost_usd: 0.000543            â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â”‚
             â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚     â”‚    EVALUATION PIPELINE                   â”‚
             â”‚     â”‚                                          â”‚
             â””â”€â”€â”€â”€â”€â”¼â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                   â”‚   â”‚  RELEVANCE EVALUATOR            â”‚    â”‚
                   â”‚   â”‚  (evaluators/relevance.py)      â”‚    â”‚
                   â”‚   â”‚                                 â”‚    â”‚
                   â”‚   â”‚  1. Embed response text         â”‚    â”‚
                   â”‚   â”‚  2. Build FAISS index           â”‚    â”‚
                   â”‚   â”‚  3. Search top-K contexts       â”‚    â”‚
                   â”‚   â”‚  4. Compute cosine similarity   â”‚    â”‚
                   â”‚   â”‚  5. Calculate relevance score   â”‚    â”‚
                   â”‚   â”‚  6. Assess completeness         â”‚    â”‚
                   â”‚   â”‚                                 â”‚    â”‚
                   â”‚   â”‚  Output:                        â”‚    â”‚
                   â”‚   â”‚    relevance_score: 0.856       â”‚    â”‚
                   â”‚   â”‚    completeness_score: 0.724    â”‚    â”‚
                   â”‚   â”‚    top_k_context_ids: [1,2,3]   â”‚    â”‚
                   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                   â”‚                â”‚                         â”‚
                   â”‚                â–¼                         â”‚
                   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                   â”‚   â”‚  FACTUAL EVALUATOR              â”‚    â”‚
                   â”‚   â”‚  (evaluators/factual.py)        â”‚    â”‚
                   â”‚   â”‚                                 â”‚    â”‚
                   â”‚   â”‚  1. Extract claims (regex)      â”‚    â”‚
                   â”‚   â”‚     - Prices: Rs 800            â”‚    â”‚
                   â”‚   â”‚     - Facts: "5 min walk"       â”‚    â”‚
                   â”‚   â”‚     - Numbers, dates, names     â”‚    â”‚
                   â”‚   â”‚                                 â”‚    â”‚
                   â”‚   â”‚  2. Verify each claim           â”‚    â”‚
                   â”‚   â”‚     - Embed claim               â”‚    â”‚
                   â”‚   â”‚     - Search contexts           â”‚    â”‚
                   â”‚   â”‚     - Check similarity          â”‚    â”‚
                   â”‚   â”‚                                 â”‚    â”‚
                   â”‚   â”‚  3. Classify:                   â”‚    â”‚
                   â”‚   â”‚     - verified (cos â‰¥ 0.8)      â”‚    â”‚
                   â”‚   â”‚     - weak (0.5 â‰¤ cos < 0.8)    â”‚    â”‚
                   â”‚   â”‚     - unverified (cos < 0.5)    â”‚    â”‚
                   â”‚   â”‚                                 â”‚    â”‚
                   â”‚   â”‚  Output:                        â”‚    â”‚
                   â”‚   â”‚    hallucination_rate: 0.125    â”‚    â”‚
                   â”‚   â”‚    verified_claims: 7/8         â”‚    â”‚
                   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                   â”‚                â”‚                         â”‚
                   â”‚                â–¼                         â”‚
                   â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
                   â”‚   â”‚  LATENCY/COST EVALUATOR         â”‚    â”‚
                   â”‚   â”‚  (evaluators/latency_cost.py)   â”‚    â”‚
                   â”‚   â”‚                                 â”‚    â”‚
                   â”‚   â”‚  1. Measure latency             â”‚    â”‚
                   â”‚   â”‚  2. Count tokens                â”‚    â”‚
                   â”‚   â”‚  3. Estimate cost               â”‚    â”‚
                   â”‚   â”‚  4. Check thresholds            â”‚    â”‚
                   â”‚   â”‚                                 â”‚    â”‚
                   â”‚   â”‚  Output:                        â”‚    â”‚
                   â”‚   â”‚    latency_ms: 245              â”‚    â”‚
                   â”‚   â”‚    estimated_cost: $0.000543    â”‚    â”‚
                   â”‚   â”‚    latency_flag: false          â”‚    â”‚
                   â”‚   â”‚    cost_flag: false             â”‚    â”‚
                   â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚         SCORING & AGGREGATION            â”‚
                   â”‚         (scoring.py)                     â”‚
                   â”‚                                          â”‚
                   â”‚  Quality Score =                         â”‚
                   â”‚    0.45 Ã— relevance                      â”‚
                   â”‚  + 0.35 Ã— (1 - hallucination)           â”‚
                   â”‚  + 0.20 Ã— completeness                   â”‚
                   â”‚                                          â”‚
                   â”‚  Check Thresholds:                       â”‚
                   â”‚    âœ“ relevance â‰¥ 0.7                     â”‚
                   â”‚    âœ“ hallucination â‰¤ 0.3                 â”‚
                   â”‚    âœ“ latency < 2000ms                    â”‚
                   â”‚    âœ“ cost < $0.01                        â”‚
                   â”‚                                          â”‚
                   â”‚  Generate Summary                        â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚       EVALUATION REPORT                  â”‚
                   â”‚                                          â”‚
                   â”‚  metadata:                               â”‚
                   â”‚    chat_id: 78128                        â”‚
                   â”‚    timestamp: 2025-12-12T10:00:00Z       â”‚
                   â”‚                                          â”‚
                   â”‚  metrics:                                â”‚
                   â”‚    relevance_score: 0.856                â”‚
                   â”‚    hallucination_rate: 0.125             â”‚
                   â”‚    latency_ms: 245                       â”‚
                   â”‚                                          â”‚
                   â”‚  aggregate:                              â”‚
                   â”‚    overall_quality: 0.782                â”‚
                   â”‚    passed_thresholds: true               â”‚
                   â”‚                                          â”‚
                   â”‚  summary:                                â”‚
                   â”‚    "ğŸŸ¢ Excellent response quality"        â”‚
                   â”‚    "âœ“ All thresholds passed"             â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚                            â”‚
              â–¼                            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  OUTPUT JSON     â”‚       â”‚  DATABASE STORAGE    â”‚
    â”‚  (results.json)  â”‚       â”‚  (persistence.py)    â”‚
    â”‚                  â”‚       â”‚                      â”‚
    â”‚  Complete report â”‚       â”‚  SQLite/PostgreSQL   â”‚
    â”‚  with all metricsâ”‚       â”‚  â€¢ evaluations table â”‚
    â”‚  and explanationsâ”‚       â”‚  â€¢ Statistics        â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚  â€¢ Query interface   â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                         â”‚
                                         â–¼
                               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                               â”‚   CLI DISPLAY        â”‚
                               â”‚   (Rich output)      â”‚
                               â”‚                      â”‚
                               â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
                               â”‚  â”‚ Summary Panel  â”‚  â”‚
                               â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
                               â”‚  â”‚ Metrics Table  â”‚  â”‚
                               â”‚  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  â”‚
                               â”‚  â”‚ Statistics     â”‚  â”‚
                               â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Data Flow Example

### Input Data
```json
// conversation.json
{
  "chat_id": 78128,
  "conversation_turns": [
    {
      "turn": 2,
      "role": "User",
      "message": "What hotels are near the clinic?"
    }
  ]
}

// context_vectors.json
{
  "data": {
    "vector_data": [
      {
        "id": 1,
        "text": "Gopal Mansion offers rooms for Rs 800 per night..."
      }
    ]
  }
}
```

### Processing Steps

**Step 1: Prompt Building**
```
You are a helpful AI assistant...

CONTEXT:
[Context 1 - hotels]: Gopal Mansion offers rooms for Rs 800...

QUESTION:
What hotels are near the clinic?

RESPONSE:
```

**Step 2: LLM Response**
```
Based on the information, I recommend Gopal Mansion 
which offers rooms for Rs 800 per night...
```

**Step 3: Evaluation**

*Relevance Check:*
```
Response embedding: [0.23, 0.45, ...]
Context embedding:  [0.21, 0.43, ...]
Cosine similarity:  0.92 âœ“ HIGH
```

*Claim Extraction:*
```
Claims found:
1. "Gopal Mansion" â†’ VERIFIED (found in context)
2. "Rs 800" â†’ VERIFIED (exact match)
3. "per night" â†’ VERIFIED (in context)
```

*Performance:*
```
Latency: 245ms âœ“
Tokens: 150 (50 in + 100 out)
Cost: $0.000543 âœ“
```

**Step 4: Scoring**
```
Relevance: 0.92 Ã— 0.45 = 0.414
Factual: (1 - 0.0) Ã— 0.35 = 0.350
Complete: 0.85 Ã— 0.20 = 0.170
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Overall Quality: 0.934 ğŸŸ¢
```

### Output Report
```json
{
  "overall_quality_score": 0.934,
  "passed_thresholds": true,
  "summary": [
    "ğŸŸ¢ Excellent response quality",
    "âœ“ Response is highly relevant",
    "âœ“ No hallucinations detected",
    "âœ“ All thresholds passed"
  ]
}
```

## Component Interactions

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   CLI    â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                  â”‚
     â”‚                        â–¼
     â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚                 â”‚   Config     â”‚
     â”‚                 â”‚  (settings)  â”‚
     â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â”œâ”€â–º Ingest â”€â”€â–º Models â”€â”€â–º Validators
     â”‚
     â”œâ”€â–º PromptBuilder â”€â”€â–º Top-K Selection
     â”‚
     â”œâ”€â–º LLMClient â”€â”€â–º [Mock | OpenAI]
     â”‚                      â”‚
     â”‚                      â–¼
     â”‚                 Track Metrics
     â”‚
     â”œâ”€â–º Evaluators:
     â”‚   â”œâ”€â–º RelevanceEvaluator
     â”‚   â”‚   â””â”€â–º FAISS + Embeddings
     â”‚   â”‚
     â”‚   â”œâ”€â–º FactualEvaluator
     â”‚   â”‚   â””â”€â–º ClaimExtractor
     â”‚   â”‚
     â”‚   â””â”€â–º LatencyCostEvaluator
     â”‚
     â”œâ”€â–º Scorer â”€â”€â–º Aggregate Results
     â”‚
     â””â”€â–º Persistence â”€â”€â–º SQLite DB
              â”‚
              â””â”€â–º Rich Display
```

## Technology Stack Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               Application Layer                  â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   CLI   â”‚  â”‚ Config  â”‚  â”‚   Models     â”‚   â”‚
â”‚  â”‚ (Click) â”‚  â”‚(Pydantic)â”‚  â”‚  (Pydantic)  â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Business Logic                    â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  Ingest â†’ Prompt â†’ LLM â†’ Evaluators      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  ML/NLP Layer                    â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Transformers   â”‚  â”‚      FAISS          â”‚   â”‚
â”‚  â”‚ (embeddings)   â”‚  â”‚ (vector search)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   sklearn      â”‚  â”‚       numpy         â”‚   â”‚
â”‚  â”‚  (utilities)   â”‚  â”‚   (computation)     â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 LLM Provider                     â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  Mock Client   â”‚  â”‚   OpenAI API        â”‚   â”‚
â”‚  â”‚ (deterministic)â”‚  â”‚  (gpt-3.5/4)        â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Persistence                      â”‚
â”‚                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  SQLAlchemy    â”‚  â”‚      SQLite         â”‚   â”‚
â”‚  â”‚     (ORM)      â”‚  â”‚    (database)       â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Execution Timeline

```
Time (ms)    Operation
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    0        Start: Load input files
   10        âœ“ JSON parsed and validated
   15        âœ“ Pydantic models created
   20        Build prompt (format contexts)
   25        âœ“ Prompt ready (1500 chars)
            
   30        Call LLM client
  130        âœ“ LLM response (mock: 100ms)
            
  140        Start evaluations in parallel:
            
            Thread 1: Relevance
  145        - Load embedding model (cached)
  160        - Encode response text
  175        - Build FAISS index
  190        - Search top-K contexts
  205        - Calculate similarities
  220        âœ“ Relevance complete
            
            Thread 2: Factual
  145        - Extract claims (regex)
  160        - Encode claims
  180        - Verify against contexts
  200        - Classify verifications
  230        âœ“ Factual complete
            
            Thread 3: Latency/Cost
  145        - Read metrics from LLM response
  146        - Calculate cost
  147        - Check thresholds
  148        âœ“ Latency/Cost complete
            
  240        Aggregate results
  245        Generate report
  250        Save to database
  255        Display results
            
  260        âœ“ Complete
```

---

*This visualization shows the complete data flow and system architecture of the LLM Evaluation Pipeline.*
